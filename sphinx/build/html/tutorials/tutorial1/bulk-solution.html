<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../../_static/favicon-32x32.png" sizes="32x32" rel="icon" type="image/png"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Protein in electrolyte" href="../level1/protein-in-electrolyte.html" /><link rel="prev" title="Contact us" href="../../non-tutorials/contact.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Bulk salt solution - </title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=8b1a507d" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">    </div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">    </span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Main</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../non-tutorials/before-you-start.html">Before you start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../non-tutorials/contact.html">Contact us</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Bulk salt solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../level1/protein-in-electrolyte.html">Protein in electrolyte</a></li>
<li class="toctree-l1"><a class="reference internal" href="../level2/stretching-a-polymer.html">Stretching a polymer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../level3/solvation-energy.html">Solvation energy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../level3/adsorption-ethanol.html">Free energy profile</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extra content</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../non-tutorials/extra/create-GRO-python.html">Write topology using Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../non-tutorials/bibliography.html">Bibliography</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alternative</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../non-tutorials/lammps.html">Use LAMMPS instead</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/tutorials/tutorial1/bulk-solution.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="bulk-salt-solution">
<span id="bulk-solution-label"></span><h1>Bulk salt solution<a class="headerlink" href="#bulk-salt-solution" title="Link to this heading">¶</a></h1>
<div class="hatnote docutils container">
<p>The very basics of GROMACS through a simple example</p>
</div>
<figure class="align-right">
<a class="only-light reference internal image-reference" href="../../_images/video-solution-white.webp"><img alt="Water solution of SO\ :sub:`4`\ :sup:`2-` and Na\ :sup:`+` ions visualized with VMD" class="only-light" src="../../_images/video-solution-white.webp" style="height: 250px;" />
</a>
</figure>
<figure class="align-right">
<a class="only-dark reference internal image-reference" href="../../_images/video-solution-dark.webp"><img alt="Water solution of SO\ :sub:`4`\ :sup:`2-` and Na\ :sup:`+` ions visualized with VMD" class="only-dark" src="../../_images/video-solution-dark.webp" style="height: 250px;" />
</a>
</figure>
<p>The objective of this tutorial is to use the open-source code GROMACS
<span id="id1">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id30" title="David Van Der Spoel, Erik Lindahl, Berk Hess, Gerrit Groenhof, Alan E Mark, and Herman JC Berendsen. Gromacs: fast, flexible, and free. Journal of computational chemistry, 26(16):1701–1718, 2005.">9</a>]</span> to perform a molecular dynamics simulation. The
system consists of a bulk solution of water mixed with sodium
(Na<sup>+</sup>) and sulfate (SO<sub>4</sub><sup>2-</sup>) ions.</p>
<p>This tutorial demonstrates how to set up a simulation box, solvate it
with water, and add ions. It also introduces key components of molecular
dynamics simulations, including energy minimization, thermostating, and
<em>NVT</em> and <em>NpT</em> equilibrations. The resulting trajectory is analyzed
using GROMACS utilities to extract properties such as the radial distribution
function (RDF) and mean squared displacement (MSD). Trajectories are
visualized using VMD <span id="id2">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id28" title="William Humphrey, Andrew Dalke, and Klaus Schulten. VMD: visual molecular dynamics. Journal of molecular graphics, 14(1):33–38, 1996.">1</a>]</span>.</p>
<div class="patreon admonition">
<p class="admonition-title">Struggling with your molecular simulations project?</p>
<p>Get guidance for your GROMACS simulations. <a class="reference internal" href="../../non-tutorials/contact.html#contact-label"><span class="std std-ref">Contact us</span></a> for
personalized <a href="https://www.patreon.com/molecularsimulations" target="_blank">advice</a> for your project.</p>
</div>
<div class="version docutils container">
<p>This tutorial is compatible with the 2024.2 GROMACS version.</p>
</div>
<section id="the-input-files">
<h2>The input files<a class="headerlink" href="#the-input-files" title="Link to this heading">¶</a></h2>
<p>In order to run the present simulation using GROMACS,
we need the 3 following files (or sets of files):</p>
<ul class="simple">
<li><p>1) A <strong>configuration file</strong> (.gro) containing the
initial positions of the atoms and the box
dimensions.</p></li>
<li><p>2) A <strong>topology file</strong> (.top) specifying the
location of the force field files (.itp).</p></li>
<li><p>3) An <strong>input file</strong> (.mdp) containing the
parameters of the simulation (e.g. temperature, timestep).</p></li>
</ul>
<p>The specificity of the present tutorial is that both configuration
and topology files were prepared with homemade Python scripts, see
<a class="reference internal" href="../../non-tutorials/extra/create-GRO-python.html#create-conf-label"><span class="std std-ref">Write topology using Python</span></a>. In principle, it is also possible to
prepare the system using GROMACS functionalities, such as
<em>gmx pdb2gmx</em>, <em>gmx trjconv</em>, or <em>gmx solvate</em>. This will be done
in the next tutorial, <a class="reference internal" href="../level1/protein-in-electrolyte.html#protein-electrolyte-label"><span class="std std-ref">Protein in electrolyte</span></a>.</p>
<section id="the-configuration-file-gro">
<h3>1) The configuration file (.gro)<a class="headerlink" href="#the-configuration-file-gro" title="Link to this heading">¶</a></h3>
<p>For the present simulation, the initial atom
positions and box size are given in a <em>conf.gro</em> file
(Gromos87 format) that you can download by clicking <a href="https://raw.githubusercontent.com/gromacstutorials/gromacstutorials-inputs/main/level1/bulk-solution/conf.gro" target="_blank">here</a>.
Save the <em>conf.gro</em> file in a folder.</p>
<p>The <em>conf.gro</em> file looks like this:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span> Na2SO4 solution
 2846
    1  SO4   O1    1   2.608   3.089   2.389
    1  SO4   O2    2   2.562   3.181   2.150
    1  SO4   O3    3   2.388   3.217   2.339
    1  SO4   O4    4   2.425   2.980   2.241
    1  SO4   S1    5   2.496   3.117   2.280
 (...)
  719  Sol  OW1 2843   3.220   2.380   1.540
  719  Sol  HW1 2844   3.279   2.456   1.540
  719  Sol  HW2 2845   3.279   2.304   1.540
  719  Sol  MW1 2846   3.230   2.380   1.540
3.36000   3.36000   3.36000
</pre></div>
</div>
<p>The first line <em>Na2SO4 solution</em> is just a comment, the second line is the
total number of atoms, and the last line is the box dimension in nanometer,
here 3.36 nm by 3.36 nm by 3.36 nm. Between the second and the
last lines, there is one line per
atom. Each line indicates, from left to right:</p>
<ul class="simple">
<li><p>the residue ID, with all the atoms from the same SO<sub>4</sub><sup>2-</sup> ion sharing the same residue ID,</p></li>
<li><p>the residue name,</p></li>
<li><p>the atom name,</p></li>
<li><p>the atom ID,</p></li>
<li><p>the atom position: <em>x</em>, <em>y</em>, and <em>z</em> coordinates in nanometer.</p></li>
</ul>
<p>Note that the format of a <em>.gro</em> file is fixed,
and each column is in a fixed position.</p>
<p>The <em>conf.gro</em> file can be visualized using VMD by
typing in the terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>conf.gro
</pre></div>
</div>
<figure class="align-default">
<img alt="Gromacs initial configuration of SO\ :sub:`4`\ :sup:`2-` and Na\ :sup:`+` ions visualized with VMD" class="only-light" src="../../_images/step0-light.png" />
</figure>
<figure class="align-default">
<img alt="Gromacs initial configuration of SO\ :sub:`4`\ :sup:`2-` and Na\ :sup:`+` ions visualized with VMD" class="only-dark" src="../../_images/step0-dark.png" />
</figure>
<div class="figurelegend docutils container">
<p>Figure: SO<sub>4</sub><sup>2-</sup> ions, Na<sup>+</sup> ions, and water molecules.
Oxygen atoms are in red, hydrogen in white, sodium in blue, and sulfur in
yellow. For better rendering, the atom representation and colors
were modified with respect to the default VMD representation. If
you want to obtain the same rendering, you can follow this
<a href="https://lammpstutorials.github.io/sphinx/build/html/tutorials/vmd/vmd-tutorial.html" target="_blank">VMD tutorial</a> from the LAMMPS tutorials webpage to obtain a similar rendering.</p>
</div>
<p>As can be seen using VMD, the water molecules are
arranged in a quite unrealistic and regular manner, with
all dipoles facing in the same direction, and possibly
wrong distances between some of the molecules and ions.
This will be fixed during energy minimization.</p>
</section>
<section id="the-topology-files-top-itp">
<h3>2) The topology files (.top .itp)<a class="headerlink" href="#the-topology-files-top-itp" title="Link to this heading">¶</a></h3>
<p>The topology file contains information about the
interactions of the different atoms and molecules. You
can download it by clicking <a href="https://raw.githubusercontent.com/gromacstutorials/gromacstutorials-inputs/main/level1/bulk-solution/topol.top" target="_blank">here</a>.
Place it in the same folder as the <em>conf.gro</em> file. The
<em>topol.top</em> file looks like that:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>#include &quot;ff/forcefield.itp&quot;
#include &quot;ff/h2o.itp&quot;
#include &quot;ff/na.itp&quot;
#include &quot;ff/so4.itp&quot;

[ System ]
Na2SO4 solution

[ Molecules ]
SO4 6
Na 12
SOL 701
</pre></div>
</div>
<p>The 4 first lines are used to include the values of the
parameters that are given in 4 separate files located in the <em>ff/</em>
folder (see below).</p>
<p>The rest of the <em>topol.top</em> file contains the system
name (<em>Na2SO4 solution</em>), and the list of the residues. Here there
is 6 SO<sub>4</sub><sup>2-</sup> ions,
12 Na<sup>+</sup> ions,
and 701 water molecules. It is crucial
that the order and number of residues in the topology file
match the order of the <em>conf.gro</em> file. If you open the <em>conf.gro</em>
file, you can see that indeed the first 30 lines beyond to the
6 SO<sub>4</sub><sup>2-</sup> residues, the next 12 lines to the
12 Na<sup>+</sup> residues, and that the remaining lines concern the
water molecules.</p>
<p>Create a folder named <em>ff/</em> next to the <em>conf.gro</em> and the
<em>topol.top</em> files, and copy
<a href="https://raw.githubusercontent.com/gromacstutorials/gromacstutorials-inputs/main/level1/bulk-solution/ff/forcefield.itp" target="_blank">forcefield.itp</a>, <a href="https://raw.githubusercontent.com/gromacstutorials/gromacstutorials-inputs/main/level1/bulk-solution/ff/h2o.itp" target="_blank">h2o.itp</a>, <a href="https://raw.githubusercontent.com/gromacstutorials/gromacstutorials-inputs/main/level1/bulk-solution/ff/na.itp" target="_blank">na.itp</a>, and <a href="https://raw.githubusercontent.com/gromacstutorials/gromacstutorials-inputs/main/level1/bulk-solution/ff/so4.itp" target="_blank">so4.itp</a>
in it. These four files contain information about
the atoms (names, masses, changes, Lennard-Jones
coefficients) and residues (bond and angular
constraints) for all the species that are involved here.</p>
<p>For instance, the <em>forcefield.itp</em> file contains a line that specifies
the combination rules as <em>comb-rule 2</em>, which corresponds to
the well-known Lorentz-Berthelot rule,
where <span class="math notranslate nohighlight">\(\epsilon_{ij} = \sqrt{\epsilon_{ii} \epsilon_{jj}}\)</span> and
<span class="math notranslate nohighlight">\(\sigma_{ij} = (\sigma_{ii}+\sigma_{jj})/2\)</span>
<span id="id3">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id8" title="Hendrik Antoon Lorentz. Ueber die anwendung des satzes vom virial in der kinetischen theorie der gase. Annalen der physik, 248(1):127–136, 1881.">10</a>, <a class="reference internal" href="../../non-tutorials/bibliography.html#id13" title="Daniel Berthelot. Sur le mélange des gaz. Compt. Rendus, 126(3):15, 1898.">11</a>]</span>:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>[ defaults ]
; nbfunc  comb-rule  gen-pairs  fudgeLJ  fudgeQQ
1       2          no         1.0      0.833
</pre></div>
</div>
<p>The fudge parameters specify how the pair interaction between
fourth neighbors in a residue are handled, which is not relevant for
the small residues considered here. The <em>forcefield.itp</em> file also
contains the list of atoms, and their respective charge in the units of
the elementary charge <span class="math notranslate nohighlight">\(e\)</span>, as well as their respective Lennard-Jones
parameters <span class="math notranslate nohighlight">\(\sigma\)</span> (in nanometer)
and <span class="math notranslate nohighlight">\(\epsilon\)</span> (in kJ/mol):</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>[ atomtypes ]
; name  at.num  mass      charge  ptype  sigma    epsilon
Na    11      22.9900   1.0000  A      0.23100  0.45000
OS     8      15.9994  -1.0000  A      0.38600  0.12
SO    16      32.0600   2.0000  A      0.35500  1.0465
HW     1       1.0079   0.5270  A      0.00000  0.00000
OW     8      15.9994   0.0000  A      0.31650  0.77323
MW     0       0.0000  -1.0540  D      0.00000  0.00000
</pre></div>
</div>
<p>Here the <em>ptype</em> is used to differential the real atoms (A), such as
hydrogens and oxygens, from the virtual and massless site of the
four-point water model (D).</p>
<p>Finally, the <em>h2o.itp</em>, <em>na.itp</em>, and <em>so4.itp</em> files contain information
about the residues, such as their exact compositions, which pairs of
atoms are connected by bonds as well as the parameters for these bonds.
In the case of the SO<sub>4</sub><sup>2-</sup>,
for instance, the sulfur atom forms a bond of equilibrium distance
<span class="math notranslate nohighlight">\(0.152~\text{nm}\)</span>
and rigidity constant <span class="math notranslate nohighlight">\(3.7656 \mathrm{e}4 ~ \text{kJ/mol/nm}^2\)</span>
with each of the four oxygen atoms:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>[ bonds ]
;  ai   aj  funct   c0         c1
    1    5    1   0.1520   3.7656e4
    2    5    1   0.1520   3.7656e4
    3    5    1   0.1520   3.7656e4
    4    5    1   0.1520   3.7656e4
</pre></div>
</div>
</section>
<section id="the-input-file-mdp">
<h3>3) The input file (.mdp)<a class="headerlink" href="#the-input-file-mdp" title="Link to this heading">¶</a></h3>
<p>The input file contains instructions about the
simulation, such as</p>
<ul class="simple">
<li><p>the number of steps to perform,</p></li>
<li><p>the thermostat to be used (e.g. Langevin <span id="id4">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id55" title="T Schneider and E Stoll. Molecular-dynamics study of a three-dimensional one-component model for distortive phase transitions. Physical Review B, 17(3):1302, 1978.">12</a>]</span>, Berendsen <span id="id5">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id54" title="Herman JC Berendsen, JPM van Postma, Wilfred F Van Gunsteren, ARHJ DiNola, and Jan R Haak. Molecular dynamics with coupling to an external bath. The Journal of chemical physics, 81(8):3684–3690, 1984.">13</a>]</span>),</p></li>
<li><p>the cut-off for the interactions,</p></li>
<li><p>the integrator or algorithms (e.g. steepest-descent <span id="id6">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id47" title="Peter Debye. Näherungsformeln für die zylinderfunktionen für große werte des arguments und unbeschränkt veränderliche werte des index. Mathematische Annalen, 67(4):535–558, 1909.">14</a>]</span>, leap-frog <span id="id7">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id24" title="Michael P Allen and Dominic J Tildesley. Computer simulation of liquids. Oxford university press, 2017.">6</a>]</span>).</p></li>
</ul>
<p>In this tutorial, 4 different input files will be
written to perform respectively an energy
minimization of the salt solution, an equilibration
in the NVT ensemble (i.e. with fixed box size), an equilibration
in the NPT ensemble (i.e. with changing box size), and finally
a production run.</p>
<p>Input files will be placed in an <em>inputs/</em> folder
that must be created next to <em>ff/</em>.</p>
<figure class="align-default">
<a class="only-light reference internal image-reference" href="../../_images/gromacs_inputs-light.png"><img alt="Gromacs files and structure folder" class="only-light" src="../../_images/gromacs_inputs-light.png" style="height: 200px;" />
</a>
</figure>
<figure class="align-default">
<a class="only-dark reference internal image-reference" href="../../_images/gromacs_inputs-dark.png"><img alt="Gromacs files and structure folder" class="only-dark" src="../../_images/gromacs_inputs-dark.png" style="height: 200px;" />
</a>
</figure>
<div class="figurelegend docutils container">
<p>Figure: Structure of the folder with the <em>.itp</em>, <em>.gro</em>, and <em>.top</em>
files.</p>
</div>
<p>The rest of the tutorial focuses on writing the input files and performing the
molecular dynamics simulation.</p>
</section>
</section>
<section id="energy-minimization">
<h2>Energy minimization<a class="headerlink" href="#energy-minimization" title="Link to this heading">¶</a></h2>
<p>It is clear from the configuration (.gro) file that the molecules and ions
are currently in a quite unphysical configuration. It would be risky to
directly start the molecular dynamics simulation as
atoms would undergo huge forces and accelerate, and the system could
eventually explode.</p>
<p>To bring the system into a more favorable state,
let us perform an energy minimization which
consists in moving the atoms until the forces between them are reasonable.</p>
<p>Open a blank file, call it <em>min.mdp</em>, and save it in the
<em>inputs/</em> folder. Copy the following lines into <em>min.mdp</em>:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>integrator = steep
nsteps = 5000
</pre></div>
</div>
<p>These two commands specify to GROMACS that the algorithm
to be used is the <a href="https://manual.gromacs.org/current/reference-manual/algorithms/energy-minimization.html" target="_blank">steepest-descent</a>
which moves the atoms following the direction of the largest forces
until one of the stopping criteria is reached <span id="id8">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id47" title="Peter Debye. Näherungsformeln für die zylinderfunktionen für große werte des arguments und unbeschränkt veränderliche werte des index. Mathematische Annalen, 67(4):535–558, 1909.">14</a>]</span>.
The <em>nsteps</em> command specifies the maximum number of steps to perform.</p>
<p>To visualize the trajectory of the atoms during the minimization,
let us also add the following command to the input
file:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>nstxout = 10
</pre></div>
</div>
<p>The <em>nstxout</em> parameter requests GROMACS to print the atom
positions every 10 steps in a <em>.trr</em> trajectory file that can
be read by VMD. We now have a very minimalist input script, let us try
it. From the terminal, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>inputs/min.mdp<span class="w"> </span>-c<span class="w"> </span>conf.gro<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>min<span class="w"> </span>-pp<span class="w"> </span>min<span class="w"> </span>-po<span class="w"> </span>min
gmx<span class="w"> </span>mdrun<span class="w"> </span>-v<span class="w"> </span>-deffnm<span class="w"> </span>min
</pre></div>
</div>
<p>The <em>grompp</em> command is used to preprocess the
files in order to prepare the simulation. The <em>grompp</em> command also
checks the validity of the files. By using
the <em>-f</em>, <em>-c</em>, and <em>-p</em> keywords, we specify which
input, configuration, and topology files must be
used, respectively. The other keywords <em>-o</em>, <em>-pp</em>, and <em>-po</em> are
used to specify the names of the output that will be
produced during the run.</p>
<p>The <em>mdrun</em> command calls the engine
performing the computation from the preprocessed
files (which is recognized thanks to the <em>-deffnm</em> keyword). The <em>-v</em>
option enables <em>verbose</em> for more
information printed in the terminal.</p>
<p>If everything works, you should see something like:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>:-) GROMACS - gmx mdrun, 2023.2 (-:
Executable:   /usr/bin/gmx
Data prefix:  /usr
(...)
Steepest Descents converged to machine precision in 961 steps,
but did not reach the requested Fmax &lt; 10.
Potential Energy  = -4.4659062e+04
Maximum force     =  2.2164763e+02 on atom 15
Norm of force     =  4.5976703e+01
</pre></div>
</div>
<p>The information printed in the terminal indicates us
that energy minimization has been performed, even
though the precision that was asked from the default
parameters were not reached. We can ignore this message,
as long as the final energy is large and negative,
the simulation will work just fine.</p>
<p>The final potential energy is large and
negative, and the maximum force is as small as <span class="math notranslate nohighlight">\(220 ~ \text{kJ/mol/nm}\)</span>
(about 0.4 pN). Everything seems alright.
Let us visualize the trajectories of the atoms during the
minimization step using VMD by typing in the terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>conf.gro<span class="w"> </span>min.trr
</pre></div>
</div>
<figure class="align-default">
<a class="only-light reference internal image-reference" href="../../_images/solution-light.webp"><img alt="Gromacs tutorial : Movie showing the motion of the atoms during the energy minimization." class="only-light" src="../../_images/solution-light.webp" style="height: 330px;" />
</a>
</figure>
<figure class="align-default">
<a class="only-dark reference internal image-reference" href="../../_images/solution-dark.webp"><img alt="Gromacs tutorial : Movie showing the motion of the atoms during the energy minimization." class="only-dark" src="../../_images/solution-dark.webp" style="height: 330px;" />
</a>
</figure>
<div class="figurelegend docutils container">
<p>Figure: Movie showing the motion of the atoms during the energy minimization.</p>
</div>
<div class="info admonition">
<p class="admonition-title">Note for VMD users</p>
<p>You can avoid having
molecules <em>cut in half</em> by the periodic boundary
conditions by rewriting the trajectory using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>trjconv<span class="w"> </span>-f<span class="w"> </span>min.trr<span class="w"> </span>-s<span class="w"> </span>min.tpr<span class="w"> </span>-o<span class="w"> </span>min_whole.trr<span class="w"> </span>-pbc<span class="w"> </span>whole
</pre></div>
</div>
<p>Then, select the group of your choice for the output.</p>
</div>
<p>One can see that the molecules reorient themselves
into more energetically favorable positions, and that
the distances between the atoms are being
progressively homogenized.</p>
<p>Let us have a look at the
evolution of the potential energy of the system. To do
so, we can use the <em>gmx energy</em> command of
GROMACS. In the terminal, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>energy<span class="w"> </span>-f<span class="w"> </span>min.edr<span class="w"> </span>-o<span class="w"> </span>potential-energy-minimization.xvg
</pre></div>
</div>
<p>Choose <em>potential</em> (in my case I have to type <em>5</em>),
then press <em>Enter</em> twice.</p>
<p>Here, the portable energy file <em>min.edr</em> produced
by GROMACS during the <em>minimization run</em> is used, and the
result is saved in the <em>potential-energy-minimization.xvg</em> file.</p>
<figure class="align-default">
<img alt="Gromacs tutorial : plot of the energy versus time." class="only-light" src="../../_images/potential-energy-min-light.png" />
</figure>
<figure class="align-default">
<img alt="Gromacs tutorial : plot of the energy versus time." class="only-dark" src="../../_images/potential-energy-min-dark.png" />
</figure>
<div class="figurelegend docutils container">
<p>Figure: Evolution of the potential energy <span class="math notranslate nohighlight">\(E_\text{p}\)</span> as a function of the
number of steps during energy minimization.</p>
</div>
<p>One can see from the energy plot that
the potential energy is initially huge and positive,
which is the consequence of atoms being too close from
one another, as well as molecules being wrongly oriented.
As the minimization progresses, the potential energy
rapidly decreases and reaches a large and negative
value, which is usually the sign
that the atoms are located at appropriate distances from each other.</p>
<p>Thank to the energy minimization, the system is now in a favorable state
and the molecular dynamics simulation can be started safely.</p>
</section>
<section id="minimalist-nvt-input-file">
<h2>Minimalist NVT input file<a class="headerlink" href="#minimalist-nvt-input-file" title="Link to this heading">¶</a></h2>
<p>Let us first perform a short (20 picoseconds)
equilibration in the NVT ensemble. In the NVT ensemble, the number of
atoms (N) and the volume (V) are maintained fixed, and the
temperature of the system (T) is adjusted using a thermostat.</p>
<p>Let us write a new input script called <em>nvt.mdp</em>, and save it in
the <em>inputs/</em> folder. Copy the following lines into it:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>integrator = md
nsteps = 20000
dt = 0.001
</pre></div>
</div>
<p>Here, the molecular dynamics (md) integrator is used, this is a leap-frog
algorithm integrating Newton equations of motion. A number of 20000 steps with
a timestep <em>dt</em> equal of <span class="math notranslate nohighlight">\(0.001 ~ \text{ps}\)</span> will be performed.</p>
<p>Let us also ask GROMACS to print the trajectory in a compressed <em>xtc</em> file
every 1000 steps, or every 1 ps, by adding the following line to <em>nvt.mdp</em>:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>nstxout-compressed = 1000
</pre></div>
</div>
<p>Let us also control the temperature throughout the
simulation using the v-rescale thermostat, which is
the Berendsen thermostat with an additional stochastic
term <span id="id9">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id46" title="Giovanni Bussi, Davide Donadio, and Michele Parrinello. Canonical sampling through velocity rescaling. The Journal of chemical physics, 2007.">15</a>]</span>.</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>tcoupl = v-rescale
ref-t = 360
tc-grps = system
tau-t = 0.5
</pre></div>
</div>
<p>The v-rescale thermostat is known to give
a proper canonical ensemble. Here, we also specified that the thermostat is
applied to the entire system using the <em>tc-grps</em> option and that the
damping constant for the thermostat, <em>tau-t</em>, is equal to 0.5 ps.</p>
<p>Note that the relatively high temperature of 360 K
has been chosen here to reduce the viscosity of the solution and
decrease the equilibration duration.</p>
<p>We now have a minimalist input file for performing
the first NVT simulation. Run it by typing in the terminal:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>gmx grompp -f inputs/nvt.mdp -c min.gro -p topol.top -o nvt -pp nvt -po nvt
gmx mdrun -v -deffnm nvt
</pre></div>
</div>
<p>Here <em>-c min.gro</em> ensures that the previously
minimized configuration is used as a starting point.</p>
<p>After the completion of the simulation, we can
ensure that the system temperature indeed reached
the value of 360 K by using the energy command of
GROMACS. In the terminal, type:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>gmx energy -f nvt.edr -o temperature-nvt-minimal.xvg
</pre></div>
</div>
<p>and choose <em>temperature</em>.</p>
<p>From the generated <em>temperature-nvt-minimal.xvg</em> file, one can see that temperature
started from 0 K, which was expected since the atoms have no velocity
during a minimization step, and reaches a temperature slightly larger than the
requested 360 K after a duration of a few picoseconds.</p>
<p>In general, it is better to perform a longer equilibration, but simulation
durations are kept as short as possible for these tutorials.</p>
<figure class="align-default">
<img alt="Gromacs tutorial : temperature versus time." class="only-light" src="../../_images/temperature-nvt-minimal-light.png" />
</figure>
<figure class="align-default">
<img alt="Gromacs tutorial : temperature versus time." class="only-dark" src="../../_images/temperature-nvt-minimal-dark.png" />
</figure>
<div class="figurelegend docutils container">
<p>Figure: Evolution of the temperature <span class="math notranslate nohighlight">\(T\)</span> as a function of
the time <span class="math notranslate nohighlight">\(t\)</span> during the NVT equilibration. The dashed line is the
requested temperature of 360 K.</p>
</div>
</section>
<section id="improving-the-nvt-input">
<h2>Improving the NVT input<a class="headerlink" href="#improving-the-nvt-input" title="Link to this heading">¶</a></h2>
<p>So far, very few commands have been placed in the
<em>.mdp</em> input file, meaning that most of the instructions
have been taken by GROMACS from the default
parameters. You can find what parameters were used
during the last nvt run by opening the new <em>nvt.mdp</em>
file that has been created in the main folder.
Exploring this new <em>nvt.mdp</em> file shows us that, for
instance, plain cut-off Coulomb interactions have
been used:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>(...)
; Method for doing electrostatics
coulombtype = Cut-off
(...)
</pre></div>
</div>
<p>For this system, computing the long-range Coulomb interactions is necessary,
because electrostatic forces between charged particles decay slowly,
as the inverse of the square of the distance between them, <span class="math notranslate nohighlight">\(1/r^2\)</span>.</p>
<p>In addition, the thermostating of the system should be improved, given that
the temperature of the system is slightly larger than the desired temperature.
For instance, separate thermostats can be applied to the water molecules
and the ions.</p>
<p>Let us improve the input used for the NVT step.
First, in the <em>nvt.mdp</em> file, let us impose the calculation of long-range
electrostatic, by the use of the
long-range fast smooth particle-mesh ewald (SPME)
electrostatics with Fourier spacing of <span class="math notranslate nohighlight">\(0.1~\text{nm}\)</span>, order
of 4, and cut-off of <span class="math notranslate nohighlight">\(1~\text{nm}\)</span> <span id="id10">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id18" title="Tom Darden, Darrin York, and Lee Pedersen. Particle mesh ewald: an n⋅ log (n) method for ewald sums in large systems. The Journal of chemical physics, 98(12):10089–10092, 1993.">16</a>, <a class="reference internal" href="../../non-tutorials/bibliography.html#id19" title="Ulrich Essmann, Lalith Perera, Max L Berkowitz, Tom Darden, Hsing Lee, and Lee G Pedersen. A smooth particle mesh ewald method. The Journal of chemical physics, 103(19):8577–8593, 1995.">17</a>]</span>:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>coulombtype = pme
fourierspacing = 0.1
pme-order = 4
rcoulomb = 1.0
</pre></div>
</div>
<p>Here, the cut-off <em>rcoulomb</em> separates the short-range interactions from the
long-range interactions. Long-range interactions are treated in the
reciprocal space, while short-range interactions are computed directly.</p>
<p>Let us also impose how the short-range van der Waals interactions
should be treated by GROMACS, as well as the cut-off <em>rvdw</em>
of <span class="math notranslate nohighlight">\(1~\text{nm}\)</span>:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>vdw-type = Cut-off
rvdw = 1.0
</pre></div>
</div>
<p>Let us use the LINCS algorithm to constrain the hydrogen
bonds <span id="id11">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id15" title="Berk Hess, Henk Bekker, Herman JC Berendsen, and Johannes GEM Fraaije. Lincs: a linear constraint solver for molecular simulations. Journal of computational chemistry, 18(12):1463–1472, 1997.">18</a>]</span>. The water
molecules will thus be treated as rigid, which is generally better given
the fast vibration of the hydrogen bonds.</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>constraint-algorithm = lincs
constraints = hbonds
continuation = no
</pre></div>
</div>
<p>Let us also use separate temperature baths for
the water molecules and the ions. Here, the ions are included
in the default GROMACS group called <em>non-water</em>.
Within <em>nvt.mdp</em>, replace the following lines:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>tcoupl = v-rescale
ref-t = 360
tc-grps = system
tau-t = 0.5
</pre></div>
</div>
<p>by:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>tcoupl = v-rescale
tc-grps = Water non-Water
tau-t = 0.5 0.5
ref-t = 360 360
</pre></div>
</div>
<p>Now, the same temperature <span class="math notranslate nohighlight">\(T = 360 ~ \text{K}\)</span> is imposed to the
two groups with the same characteristic time <span class="math notranslate nohighlight">\(\tau = 0.5 ~ \text{ps}\)</span>.</p>
<p>Let us also specify the neighbor searching parameters:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>cutoff-scheme = Verlet
nstlist = 10
ns_type = grid
</pre></div>
</div>
<p>Let us give an initial kick to the atom so that the initial
total velocities give the desired temperature of 360 K instead of 0 K
as previously:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>gen-vel = yes
gen-temp = 360
</pre></div>
</div>
<p>Finally, let us cancel the translational of the center of mass
of the system:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>comm_mode = linear
comm_grps = system
</pre></div>
</div>
<p>Run again GROMACS using this new input script. One difference with the
previous (minimalist) NVT run is
the temperature at the beginning of the run. The final
temperature is also much closer to the desired temperature of 360 K.</p>
<figure class="align-default">
<img alt="Gromacs tutorial : temperature versus time." class="only-light" src="../../_images/temperature-nvt-light.png" />
</figure>
<figure class="align-default">
<img alt="Gromacs tutorial : temperature versus time." class="only-dark" src="../../_images/temperature-nvt-dark.png" />
</figure>
<div class="figurelegend docutils container">
<p>Figure: Evolution of the temperature as a function of the time
during the NVT equilibration.</p>
</div>
</section>
<section id="adjust-the-density-using-npt">
<h2>Adjust the density using NPT<a class="headerlink" href="#adjust-the-density-using-npt" title="Link to this heading">¶</a></h2>
<p>Now that the temperature of the system is properly equilibrated,
let us continue the simulation using the
NPT ensemble, where the pressure of the system is imposed by a barostat
and the volume of the box is allowed to relax. During NPT relaxation, the
density of the fluid should converge toward its equilibrium value.
Create a new input script, call it <em>npt.mdp</em>, and
copy the following lines in it:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>integrator = md
nsteps = 80000
dt = 0.001

comm_mode = linear
comm_grps = system

cutoff-scheme = Verlet
nstlist = 10
ns_type = grid

nstlog = 100
nstenergy = 100
nstxout-compressed = 1000

vdw-type = Cut-off
rvdw = 1.0

coulombtype = pme
fourierspacing = 0.1
pme-order = 4
rcoulomb = 1.0

constraint-algorithm = lincs
constraints = hbonds

tcoupl = v-rescale
ld-seed = 48456
tc-grps = Water non-Water
tau-t = 0.5 0.5
ref-t = 360 360

pcoupl = C-rescale
Pcoupltype = isotropic
tau_p = 1.0
ref_p = 1.0
compressibility = 4.5e-5
</pre></div>
</div>
<p>The main difference with the previous NVT script is
the addition of the isotropic C-rescale pressure
coupling with a target pressure of 1 bar <span id="id12">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id17" title="Mattia Bernetti and Giovanni Bussi. Pressure control using stochastic cell rescaling. The Journal of Chemical Physics, 2020.">19</a>]</span>.
Another difference is the addition of the <em>nstlog</em> and
<em>nstenergy</em> commands to control the frequency at
which information is printed in the log file and in
the energy file (<em>edr</em>). Note also the removing the
<em>gen-vel</em> commands, because the atoms already have a velocity.</p>
<p>Run the NPT equilibration using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>inputs/npt.mdp<span class="w"> </span>-c<span class="w"> </span>nvt.gro<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>npt<span class="w"> </span>-pp<span class="w"> </span>npt<span class="w"> </span>-po<span class="w"> </span>npt
gmx<span class="w"> </span>mdrun<span class="w"> </span>-v<span class="w"> </span>-deffnm<span class="w"> </span>npt
</pre></div>
</div>
<p>Let us have a look a the temperature, the pressure, and the
volume of the box during the NPT step using the <em>gmx energy</em>
command 3 consecutive times:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>energy<span class="w"> </span>-f<span class="w"> </span>npt.edr<span class="w"> </span>-o<span class="w"> </span>temperature-npt.xvg
gmx<span class="w"> </span>energy<span class="w"> </span>-f<span class="w"> </span>npt.edr<span class="w"> </span>-o<span class="w"> </span>pressure-npt.xvg
gmx<span class="w"> </span>energy<span class="w"> </span>-f<span class="w"> </span>npt.edr<span class="w"> </span>-o<span class="w"> </span>density-npt.xvg
</pre></div>
</div>
<p>Choose respectively <em>temperature</em>, <em>pressure</em> and <em>density</em>.
This is what I see:</p>
<figure class="align-default">
<img alt="Gromacs tutorial : NPT equilibration" class="only-light" src="../../_images/temperature-npt-light.png" />
</figure>
<figure class="align-default">
<img alt="Gromacs tutorial : NPT equilibration" class="only-dark" src="../../_images/temperature-npt-dark.png" />
</figure>
<div class="figurelegend docutils container">
<p>Figure: Evolution of the temperature <span class="math notranslate nohighlight">\(T\)</span> (a),
pressure <span class="math notranslate nohighlight">\(p\)</span> (b),
and fluid density <span class="math notranslate nohighlight">\(\rho\)</span> (c) as a
function of the time during the NPT equilibration.</p>
</div>
<p>The results show that the temperature remains well
controlled during the NPT run, and
that the fluid density was initially too small,
i.e. <span class="math notranslate nohighlight">\(\rho \approx 600\,\mathrm{kg}/\mathrm{m}^3\)</span>.
Due to the change in volume induced by the barostat, the fluid density
gently reaches its equilibrium value of about <span class="math notranslate nohighlight">\(1000\,\mathrm{kg}/\mathrm{m}^3\)</span>
after approximately 40 pico-seconds. Once the system has reached its equilibrium
density, the pressure stabilizes itself near the desired value of 1 bar.</p>
<p>The pressure curve reveals large oscillations in the pressure, with the pressure alternating between large negative
values and large positive values. These large oscillations are typical in molecular dynamics, and not a source of
concern here.</p>
</section>
<section id="radial-distribution-function">
<h2>Radial distribution function<a class="headerlink" href="#radial-distribution-function" title="Link to this heading">¶</a></h2>
<p>Let us perform a <span class="math notranslate nohighlight">\(400~\text{ps}\)</span> run in the NVT ensemble, during which the atom positions will be printed every
pico-second. The trajectory will then be used to measure radial distribution functions and probe the solvation
environment of the ions.</p>
<p>Create a new input file within the <em>inputs/</em> folder, call it <em>production.mdp</em>, and copy the following lines into it:</p>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>integrator = md
nsteps = 400000
dt = 0.001

comm_mode = linear
comm_grps = system

cutoff-scheme = Verlet
nstlist = 10
ns_type = grid

nstlog = 100
nstenergy = 100
nstxout-compressed = 1000

vdw-type = Cut-off
rvdw = 1.0

coulombtype = pme
fourierspacing = 0.1
pme-order = 4
rcoulomb = 1.0

constraint-algorithm = lincs
constraints = hbonds

tcoupl = v-rescale
ld-seed = 48456
tc-grps = Water non-Water
tau-t = 0.5 0.5
ref_t = 360 360
</pre></div>
</div>
<p>Run it using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>inputs/production.mdp<span class="w"> </span>-c<span class="w"> </span>npt.gro<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>production<span class="w"> </span>-pp<span class="w"> </span>production<span class="w"> </span>-po<span class="w"> </span>production
gmx<span class="w"> </span>mdrun<span class="w"> </span>-v<span class="w"> </span>-deffnm<span class="w"> </span>production
</pre></div>
</div>
<p>When the simulation is completed, let us compute the radial
distribution functions between <span class="math notranslate nohighlight">\(\text{Na}^+\)</span> and
<span class="math notranslate nohighlight">\(\text{H}_2\text{O}\)</span>,
<span class="math notranslate nohighlight">\(\text{SO}_4^{2-}\)</span> and
<span class="math notranslate nohighlight">\(\text{H}_2\text{O}\)</span>,
as well as in between <span class="math notranslate nohighlight">\(\text{H}_2\text{O}\)</span> molecules.
This can be done using the <em>gmx rdf</em> command as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>rdf<span class="w"> </span>-f<span class="w"> </span>production.xtc<span class="w"> </span>-s<span class="w"> </span>production.tpr<span class="w"> </span>-o<span class="w"> </span>na-sol-rdf.xvg
</pre></div>
</div>
<p>Selecting the sodium ions, and then the water. Repeat the same operation for
the sulfate and water, and for the water and water. For the water-water
RDF, it is better to exclude the intra-molecular contribution using
the <em>-excl</em> option, as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>rdf<span class="w"> </span>-f<span class="w"> </span>production.xtc<span class="w"> </span>-s<span class="w"> </span>production.tpr<span class="w"> </span>-o<span class="w"> </span>sol-sol-rdf.xvg<span class="w"> </span>-excl
</pre></div>
</div>
<figure class="align-default">
<img alt="Gromacs tutorial RDF radial distribution function" class="only-light" src="../../_images/rdf-production-light.png" />
</figure>
<figure class="align-default">
<img alt="Gromacs tutorial RDF radial distribution function" class="only-dark" src="../../_images/rdf-production-dark.png" />
</figure>
<div class="figurelegend docutils container">
<p>Figure: Radial distribution functions (RDF) as calculated between sodium
and water, between sulfate and water, and finally between water and water.</p>
</div>
<p>The radial distribution functions highlight the typical distance between
the different species of the fluid. For instance, it can be seen that
there is a strong hydration layer of water around sodium ions at a typical
distance of <span class="math notranslate nohighlight">\(2.4 ~ \text{Å}\)</span> from the center of the sodium ion.</p>
</section>
<section id="mean-square-displacement">
<h2>Mean square displacement<a class="headerlink" href="#mean-square-displacement" title="Link to this heading">¶</a></h2>
<p>To probe the system dynamics, let us compute the mean square
displacement for all 3 species.  For the sulfate ion, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>msd<span class="w"> </span>-f<span class="w"> </span>production.xtc<span class="w"> </span>-s<span class="w"> </span>production.tpr<span class="w"> </span>-o<span class="w"> </span>so4-msd.xvg
</pre></div>
</div>
<p>Select the <span class="math notranslate nohighlight">\(\text{SO}_4^{2-}\)</span> ions (in my case, it is done by typing
<em>2</em>), and then press <em>ctrl D</em>. Repeat the same operation for the sodium
ions and for the water molecules.</p>
<p>The slope of the MSD in the limit of long times gives an estimate of the diffusion
coefficient, following <span class="math notranslate nohighlight">\(D = \text{MSD} / 2 d t\)</span>,
where <span class="math notranslate nohighlight">\(d = 3\)</span> is the dimension of the system. Here,
I find a value of <span class="math notranslate nohighlight">\(1.4 \mathrm{e}-5 ~ \text{cm}^2/\text{s}\)</span> for the
diffusion coefficient of the sulfur ions.</p>
<p>Repeat the same for <span class="math notranslate nohighlight">\(\text{Na}^+\)</span> and water.</p>
<p>For sodium, I find a value of <span class="math notranslate nohighlight">\(1.6 \mathrm{e}-5 ~ \text{cm}^2/\text{s}\)</span>
for the diffusion coefficient,
and for water <span class="math notranslate nohighlight">\(5.3 \mathrm{e}-5 ~ \text{cm}^2/\text{s}\)</span>.
For comparison, the experimental diffusion coefficient of <em>pure</em> water at
temperature <span class="math notranslate nohighlight">\(T = 360~\text{K}\)</span>
is <span class="math notranslate nohighlight">\(7.3 \mathrm{e}-5 ~ \text{cm}^2/\text{s}\)</span> <span id="id13">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id7" title="JH Simpson and HY Carr. Diffusion and nuclear spin relaxation in water. Physical Review, 111(5):1201, 1958.">20</a>]</span>.
In the presence of ions, the diffusion coefficient of water is expected to
be reduced.</p>
<figure class="align-default">
<img alt="Gromacs tutorial : diffusion coefficient" class="only-light" src="../../_images/msd-production-light.png" />
</figure>
<figure class="align-default">
<img alt="Gromacs tutorial : diffusion coefficient" class="only-dark" src="../../_images/msd-production-dark.png" />
</figure>
<div class="figurelegend docutils container">
<p>Figure: Mean square displacement (msd) for the three species. The dashed line
highlight the proportionality between msd and time <span class="math notranslate nohighlight">\(t\)</span> which is expected
at long times, when the system reaches the diffusive regime.</p>
</div>
<div class="info admonition">
<p class="admonition-title">About diffusion coefficient measurement in molecular simulations</p>
<p>In principle, diffusion coefficients obtained from the MSD in a
finite-sized box must be corrected, but this is beyond the scope of
the present tutorial <span id="id14">[<a class="reference internal" href="../../non-tutorials/bibliography.html#id9" title="Philip Loche, Patrick Steinbrunner, Sean Friedowitz, Roland R Netz, and Douwe Jan Bonthuis. Transferable ion force fields in water from a simultaneous optimization of ion solvation and ion–ion interaction. The Journal of Physical Chemistry B, 125(30):8581–8587, 2021.">21</a>]</span>.</p>
</div>
<p>You can access all the input scripts and data files that
are used in these tutorials from <a href="https://github.com/gromacstutorials/gromacstutorials-inputs" target="_blank">GitHub</a>.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../level1/protein-in-electrolyte.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Protein in electrolyte</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../../non-tutorials/contact.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Contact us</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Bulk salt solution</a><ul>
<li><a class="reference internal" href="#the-input-files">The input files</a><ul>
<li><a class="reference internal" href="#the-configuration-file-gro">1) The configuration file (.gro)</a></li>
<li><a class="reference internal" href="#the-topology-files-top-itp">2) The topology files (.top .itp)</a></li>
<li><a class="reference internal" href="#the-input-file-mdp">3) The input file (.mdp)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#energy-minimization">Energy minimization</a></li>
<li><a class="reference internal" href="#minimalist-nvt-input-file">Minimalist NVT input file</a></li>
<li><a class="reference internal" href="#improving-the-nvt-input">Improving the NVT input</a></li>
<li><a class="reference internal" href="#adjust-the-density-using-npt">Adjust the density using NPT</a></li>
<li><a class="reference internal" href="#radial-distribution-function">Radial distribution function</a></li>
<li><a class="reference internal" href="#mean-square-displacement">Mean square displacement</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>