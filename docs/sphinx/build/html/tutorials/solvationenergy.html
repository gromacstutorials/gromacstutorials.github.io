<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BFND91CYC2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-BFND91CYC2');
    </script>
    <link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Free energy profile" href="ethanoladsorption.html" /><link rel="prev" title="Bulk salt solution" href="bulksolution.html" />

    <!-- Generated with Sphinx 6.1.3 and Furo 2022.12.07 -->
        <title>Molecule solvation energy - </title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">    </div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">    </span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Main</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../howto.html">How-to</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bulksolution.html">Bulk salt solution</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Molecule solvation energy</a></li>
<li class="toctree-l1"><a class="reference internal" href="ethanoladsorption.html">Free energy profile</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extra content</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contact/contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/participation.html">Wanna contribute?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/vmd.html">VMD tips</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="molecule-solvation-energy">
<span id="bulk-solution-label"></span><h1>Molecule solvation energy<a class="headerlink" href="#molecule-solvation-energy" title="Permalink to this heading">#</a></h1>
<div class="hatnote docutils container">
<p>Free energy solvation calculation of a
disk-like molecule</p>
</div>
<figure class="align-right">
<a class="reference internal image-reference" href="../_images/banner.png"><img alt="HBC (graphene-like) molecule in water" src="../_images/banner.png" style="height: 250px;" /></a>
</figure>
<div class="justify docutils container">
<p><strong>The objective of this tutorial</strong> is to use GROMACS
to perform a molecular dynamics simulation, and to
calculate the free energy of solvation of a
graphene-like molecule named hexabenzocoronene.</p>
</div>
<section id="input-files">
<h2>Input files<a class="headerlink" href="#input-files" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>Create two folders named ‘preparation/’ and
‘solvation’ in the same directory. Go to
‘preparation/’.</p>
<p>Download the configuration files for the HBC molecule
from the atb repository: click
<a class="reference external" href="https://atb.uq.edu.au/molecule.py?molid=151371#panel-md">here</a>,
download the structure file ‘All-Atom PDB (optimised
geometry)’ and place it in the ‘preparation/’ folder.</p>
</div>
<section id="create-the-configuration-file">
<h3>Create the configuration file<a class="headerlink" href="#create-the-configuration-file" title="Permalink to this heading">#</a></h3>
<div class="justify docutils container">
<p>First, let us convert the pdb file into a gro file
within a box of finite size using trj conv:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>gmx trjconv -f FJEW_allatom_optimised_geometry.pdb -s FJEW_allatom_optimised_geometry.pdb -o hbc.gro -box 3 3 3 -center
</pre></div>
</div>
<div class="justify docutils container">
<p>Select ‘system’ for both centering and output. If you
open the hbc.gro file with VMD, you will see:</p>
</div>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="../_images/hbc.png"><img alt="GROMACS tutorial : HBC (graphene) molecule with VMD" src="../_images/hbc.png" style="height: 150px;" /></a>
<figcaption>
<p><span class="caption-text">HBC molecule with carbon atoms in gray and hydrogen
atoms in white.</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="justify docutils container">
<p>You can also download the <a href="../../../../inputs/02-HBCSolvationEnergy/preparation/hbc.gro" target="_blank">here</a>
I have generated.</p>
</div>
</section>
<section id="create-the-topology-file">
<h3>Create the topology file<a class="headerlink" href="#create-the-topology-file" title="Permalink to this heading">#</a></h3>
<div class="justify docutils container">
<p>From the <a class="reference external" href="https://atb.uq.edu.au/molecule.py?molid=151371#panel-md">same atb
page</a>,
copy the ‘GROMACS G54A7FF All-Atom (ITP file)’ and
place it in a folder named ‘ff/’ and located within
the ‘preparation/’ folder. Within ‘ff/’ download as
well the GROMACS top file named <a class="reference external" href="https://atb.uq.edu.au/forcefield_files/atb_gromacs/5/gromos54a7_atb.ff.tar.gz">Gromacs 4.5.x-5.x.x
54a7</a>
containing all the force field parameters.
Then, let us write the topology file by simply
creating a blank file named ‘topol.top’ within the
‘preparation/’ folder, and copying in it:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>#include &quot;ff/gromos54a7_atb.ff/forcefield.itp&quot;
#include &quot;ff/FJEW_GROMACS_G54A7FF_allatom.itp&quot;

[ system ]
Single HBC molecule

[ molecules ]
FJEW 1
</pre></div>
</div>
</section>
<section id="add-the-water">
<h3>Add the water<a class="headerlink" href="#add-the-water" title="Permalink to this heading">#</a></h3>
<div class="justify docutils container">
<p>Let us add water molecules. First download the tip4p
water configuration file <a href="../../../../inputs/02-HBCSolvationEnergy/preparation/tip4p.gro" target="_blank">here</a>,
and copy it in the ‘preparation/’ folder. Then, in
order to add (tip4p) water molecules to both gro and
top file, use the gmx solvate command as follow:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>gmx solvate -cs tip4p.gro -cp hbc.gro -o solvated.gro -p topol.top
</pre></div>
</div>
<div class="justify docutils container">
<p>You should see the following message:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>Processing topology
Adding line for 887 solvent molecules with resname (SOL) to topology file (topol.top)
</pre></div>
</div>
<div class="justify docutils container">
<p>and a new line ‘SOL 887’ in the topology file:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>[ molecules ]
FJEW 1
SOL 887
</pre></div>
</div>
<div class="justify docutils container">
<p>The created ‘solvated.gro’ file contains the positions
of both HBC (called FJEW) and water molecules , you
can download the file I have generated by clicking <a href="../../../../inputs/02-HBCSolvationEnergy/preparation/solvated.gro" target="_blank">here</a>.</p>
<p>The only missing information is the force field for
the water molecule. In order to use the TIP4P/epsilon
water model, which is one of the best classical water model, copy the
<a href="../../../../inputs/02-HBCSolvationEnergy/preparation/ff/h2o.itp" target="_blank">h2o.itp</a> file in the ‘ff/’ folder and modify the beginning of
the topology file as follow:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>#include &quot;ff/gromos54a7_atb.ff/forcefield.itp&quot;
#include &quot;ff/FJEW_GROMACS_G54A7FF_allatom.itp&quot;
#include &quot;ff/h2o.itp&quot;
</pre></div>
</div>
</section>
</section>
<section id="energy-minimization">
<h2>Energy minimization<a class="headerlink" href="#energy-minimization" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>Create a new folder in the preparation/’ folder, call
it ‘inputs’, and save a new blank file, called
min.mdp, in it. Copy the following lines into min.mdp:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>integrator = steep
nsteps = 50

nstxout = 10

cutoff-scheme = Verlet
nstlist = 10
ns_type = grid

vdw-type = Cut-off
rvdw = 1.4

coulombtype = pme
fourierspacing = 0.1
pme-order = 4
rcoulomb = 1.4

constraint-algorithm = lincs
constraints = hbonds
</pre></div>
</div>
<div class="justify docutils container">
<p>All these lines have been seen in the previous
tutorial. In short, this script will perform a
steepest descent by updating the atom positions
according the the largest forces directions, until
the energy and maximum force reach a reasonable
value. Apply the minimisation to the solvated box using :</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>inputs/min.mdp<span class="w"> </span>-c<span class="w"> </span>solvated.gro<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>min<span class="w"> </span>-pp<span class="w"> </span>min<span class="w"> </span>-po<span class="w"> </span>min<span class="w"> </span>-maxwarn<span class="w"> </span><span class="m">1</span>
gmx<span class="w"> </span>mdrun<span class="w"> </span>-v<span class="w"> </span>-deffnm<span class="w"> </span>min
</pre></div>
</div>
<div class="justify docutils container">
<p>Here the ‘-maxwarn 1’ allows us to perform the
simulation despite GROMACS’ warning about some force
field issue. Since this is a tutorial and not actual
research, we ca safely ignore this warning.
Let us visualize the atoms’ trajectories during the
minimization step using VMD by typing:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>solvate.gro<span class="w"> </span>min.trr
</pre></div>
</div>
<div class="justify docutils container">
<p>This is what I see:</p>
</div>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="../_images/min1.gif"><img alt="GROMACS tutorial : HBC (graphene) molecule during minimisation in water" src="../_images/min1.gif" style="height: 150px;" /></a>
<figcaption>
<p><span class="caption-text">Movie showing the motion of the atoms during the
energy minimization.</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="justify docutils container">
<p><strong>Note for VMD user:</strong> You can avoid having
molecules ‘cut in half’ by the periodic boundary
conditions by rewriting the trajectory using ‘gmx
trjconv -f min.trr -s min.tpr -o min_whole.trr -pbc whole’</p>
</div>
</section>
<section id="equilibration">
<h2>Equilibration<a class="headerlink" href="#equilibration" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>Let us perform successively a NVT and a NPT relaxation. Copy the <a href="../../../../inputs/02-HBCSolvationEnergy/preparation/inputs/nvt.mdp" target="_blank">nvt.mdp</a>
and the <a href="../../../../inputs/02-HBCSolvationEnergy/preparation/inputs/npt.mdp" target="_blank">npt.mdp</a> files into the inputs folder, and run them both using:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>inputs/nvt.mdp<span class="w"> </span>-c<span class="w"> </span>min.gro<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>nvt<span class="w"> </span>-pp<span class="w"> </span>nvt<span class="w"> </span>-po<span class="w"> </span>nvt<span class="w"> </span>-maxwarn<span class="w"> </span><span class="m">1</span>
gmx<span class="w"> </span>mdrun<span class="w"> </span>-v<span class="w"> </span>-deffnm<span class="w"> </span>nvt
gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>inputs/npt.mdp<span class="w"> </span>-c<span class="w"> </span>nvt.gro<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>npt<span class="w"> </span>-pp<span class="w"> </span>npt<span class="w"> </span>-po<span class="w"> </span>npt<span class="w"> </span>-maxwarn<span class="w"> </span><span class="m">1</span>
gmx<span class="w"> </span>mdrun<span class="w"> </span>-v<span class="w"> </span>-deffnm<span class="w"> </span>npt
</pre></div>
</div>
<div class="justify docutils container">
<p>The simulation looks like that:</p>
</div>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="../_images/nvtnpt.gif"><img alt="GROMACS tutorial : HBC (graphene) molecule during NVT and NPT equilibration" src="../_images/nvtnpt.gif" style="height: 150px;" /></a>
<figcaption>
<p><span class="caption-text">Movie showing the motion of the atoms during the
NVT and NPT equilibration steps. For clarity, the
water molecules are represented as a continuum field.</span><a class="headerlink" href="#id3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="solvation">
<h2>Solvation<a class="headerlink" href="#solvation" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>We are done with the first equilibration of the
system. We are now going to perform the solvation
free energy calculation, for which 21 independent
simulations will be performed.</p>
</div>
<div class="justify docutils container">
<p><strong>Quick explanation of the procedure:</strong> The
interactions between the HBC molecule and water
are progressively turned-off, thus effectively
mimicking the HBC molecule moving from bulk water
to vacuum.</p>
</div>
<div class="justify docutils container">
<p>Within the ‘solvation/’ folder, create an ‘inputs/’
folders. Copy the two following
<a href="../../../../inputs/02-HBCSolvationEnergy/solvation/inputs/npt_bis.mdp" target="_blank">npt_bis.mdp</a> and <a href="../../../../inputs/02-HBCSolvationEnergy/solvation/inputs/pro.mdp" target="_blank">pro.mdp</a> files in it.</p>
</div>
<div class="justify docutils container">
<p>Both files contain the following commands that are
related to the free energy calculation:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>free_energy = yes
vdw-lambdas = 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
coul-lambdas = 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0
sc-alpha = 0.5
sc-power = 1
init-lambda-state =  0
couple-lambda0 = none
couple-lambda1 = vdw-q
nstdhdl = 100
calc_lambda_neighbors = -1
couple-moltype = FJEW
</pre></div>
</div>
<div class="justify docutils container">
<p>These lines specify that the decoupling between the
molecule of interest (here FJEW) and the rest of
the system (here water) must be done by
progressively turning off van der Waals and Coulomb
interactions. The  parameter controls the frequency at
which information are being printed in a xvg file during
the production run.</p>
<p>In addition, the stochastic integrator ‘sd’ is used
instead of ‘md’, as it provides a better sampling,
which is crutial here, particularly when the HBC
and the water are not coupled.</p>
<p>Copy as well the following <a href="../../../../inputs/02-HBCSolvationEnergy/solvation/topol.top" target="_blank">topol.top</a> file within the ‘solvation/’ folder (the only
difference with the previous one if the path to the ff folder).</p>
</div>
<div class="justify docutils container">
<p>We need to create 21 folders, each containing the
input files with different value of
init-lambda-state (from 0 to 21). To do so, create
a new bash file fine within the ‘solvation/’
folder, call it ‘createfolders.sh’ can copy the
following lines in it:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>#/bin/bash
# delete runall.sh if it exist, then re-create it
if test -f &quot;runall.sh&quot;; then
    rm runall.sh
fi
touch runall.sh
echo &#39;#/bin/bash&#39; &gt;&gt; runall.sh
echo &#39;&#39; &gt;&gt; runall.sh
# folder for analysis
mkdir -p dhdl
# loop on the 21 lambda state
for state in $(seq 0 20);
do
    # create folder
    DIRNAME=lambdastate${state}
    mkdir -p $DIRNAME
    # copy the topology, inputs, and configuration file in the folder
    cp -r topol.top $DIRNAME
    cp -r ../preparation/npt.gro $DIRNAME/preparedstate.gro
    cp -r inputs $DIRNAME
    # replace the lambda state in both npt_bis and production mdp file
    newline=&#39;init-lambda-state = &#39;$state
    linetoreplace=$(cat $DIRNAME/inputs/npt_bis.mdp | grep init-lambda-state)
    sed -i &#39;/&#39;&quot;$linetoreplace&quot;&#39;/c\&#39;&quot;$newline&quot; $DIRNAME/inputs/npt_bis.mdp
    sed -i &#39;/&#39;&quot;$linetoreplace&quot;&#39;/c\&#39;&quot;$newline&quot; $DIRNAME/inputs/pro.mdp
    # create a bash file to launch all the simulations
    echo &#39;cd &#39;$DIRNAME &gt;&gt; runall.sh
    echo &#39;gmx grompp -f inputs/npt_bis.mdp -c preparedstate.gro -p topol.top -o npt_bis -pp npt_bis -po npt_bis -maxwarn 1&#39; &gt;&gt; runall.sh
    echo &#39;gmx mdrun -v -deffnm npt_bis&#39; &gt;&gt; runall.sh
    echo &#39;gmx grompp -f inputs/pro.mdp -c npt_bis.gro -p topol.top -o pro -pp pro -po pro -maxwarn 1&#39; &gt;&gt; runall.sh
    echo &#39;gmx mdrun -v -deffnm pro&#39; &gt;&gt; runall.sh
    echo &#39;cd ..&#39; &gt;&gt; runall.sh
    echo &#39;&#39; &gt;&gt; runall.sh
    # create links for the analysis
    cd dhdl
    ln -sf ../$DIRNAME/pro.xvg md$state.xvg
    cd ..
done
</pre></div>
</div>
<div class="justify docutils container">
<p>Execute the bash script by typing:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>createfolders.sh
</pre></div>
</div>
<div class="justify docutils container">
<p>The bash file creates 21 folders, each containing
the input files with init-lambda-state from 0 to
21, as well as a ‘topol.top’ file and a
‘preparedstate.gro’ corresponding to the last
state of the system simulated in the
‘preparation/’ folder. Run all 21 simulations by executing the ‘runall.sh’ script:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>runall.sh
</pre></div>
</div>
<div class="justify docutils container">
<p>This may take a while.
When its complete, go the dhdl folder, and type:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>bar<span class="w"> </span>-f<span class="w"> </span>*.xvg
</pre></div>
</div>
<div class="justify docutils container">
<p>The value of the solvation energy is printed in the terminal:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>total<span class="w"> </span><span class="m">0</span><span class="w"> </span>-<span class="w"> </span><span class="m">20</span>,<span class="w"> </span>DG<span class="w"> </span>-37.0<span class="w"> </span>+/-<span class="w"> </span><span class="m">8</span>.40
</pre></div>
</div>
<div class="justify docutils container">
<p>The present simulations are too short to give a
proper result. To actually measure the solvation
energy of a molecule, use much longer equilibration
(typically one nanosecond) and production runs
(typically several nanoseconds).</p>
</div>
</section>
<section id="going-further-with-exercises">
<h2>Going further with exercises<a class="headerlink" href="#going-further-with-exercises" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p><strong>Solvation energy of another molecule</strong></p>
<p>Choose another molecule on the atb data base and
calculate its free energy of solvation using the
same method.</p>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="ethanoladsorption.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Free energy profile</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="bulksolution.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Bulk salt solution</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Molecule solvation energy</a><ul>
<li><a class="reference internal" href="#input-files">Input files</a><ul>
<li><a class="reference internal" href="#create-the-configuration-file">Create the configuration file</a></li>
<li><a class="reference internal" href="#create-the-topology-file">Create the topology file</a></li>
<li><a class="reference internal" href="#add-the-water">Add the water</a></li>
</ul>
</li>
<li><a class="reference internal" href="#energy-minimization">Energy minimization</a></li>
<li><a class="reference internal" href="#equilibration">Equilibration</a></li>
<li><a class="reference internal" href="#solvation">Solvation</a></li>
<li><a class="reference internal" href="#going-further-with-exercises">Going further with exercises</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    </body>
</html>