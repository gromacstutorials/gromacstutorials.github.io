<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../../_static/favicon-32x32.png" sizes="32x32" rel="icon" type="image/png"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Free energy profile" href="adsorption-ethanol.html" /><link rel="prev" title="Polymer in water" href="../level2/stretching-a-polymer.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.05.06 -->
        <title>Molecule solvation energy - </title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=e69558d9" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">    </div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">    </span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Main</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../non-tutorials/before-you-start.html">Before you start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../non-tutorials/contact.html">Contact me</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Level 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../level1/bulk-solution.html">Bulk salt solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../level1/protein-in-electrolyte.html">Protein in electrolyte</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Level 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../level2/stretching-a-polymer.html">Polymer in water</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Level 3</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Molecule solvation energy</a></li>
<li class="toctree-l1"><a class="reference internal" href="adsorption-ethanol.html">Free energy profile</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extra content</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../non-tutorials/extra/create-GRO-python.html">Write topology using Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../non-tutorials/bibliography.html">Bibliography</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alternative</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../non-tutorials/lammps.html">Use LAMMPS instead</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/tutorials/level3/solvation-energy.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="molecule-solvation-energy">
<span id="solvation-energy-label"></span><h1>Molecule solvation energy<a class="headerlink" href="#molecule-solvation-energy" title="Link to this heading">¶</a></h1>
<div class="hatnote docutils container">
<p>Free energy solvation calculation of a graphene-like molecule</p>
</div>
<figure class="align-right">
<a class="only-light reference internal image-reference" href="../../_images/video-HBC-light-2.webp"><img alt="HBC (graphene-like) molecule in water" class="only-light" src="../../_images/video-HBC-light-2.webp" style="height: 250px;" /></a>
</figure>
<figure class="align-right">
<a class="only-dark reference internal image-reference" href="../../_images/video-HBC-dark-2.webp"><img alt="HBC (graphene-like) molecule in water" class="only-dark" src="../../_images/video-HBC-dark-2.webp" style="height: 250px;" /></a>
</figure>
<div class="justify docutils container">
<p>The objective of this tutorial is to use GROMACS
to perform a molecular dynamics simulation, and to
calculate the free energy of solvation of a
large molecule in water.</p>
</div>
<div class="justify docutils container">
<p>The large molecule used here is a graphene-like and
discoid molecule named hexabenzocoronene.</p>
</div>
<section id="input-files">
<h2>Input files<a class="headerlink" href="#input-files" title="Link to this heading">¶</a></h2>
<div class="justify docutils container">
<p>Create two folders named ‘preparation/’ and
‘solvation/’ in the same directory, and go to
‘preparation/’.</p>
</div>
<div class="justify docutils container">
<p>Download the configuration files for the HBC molecule
by clicking <a href="../../../../../gromacstutorials-inputs/level3/solvation-energy/preparation/FJEW_allatom_optimised_geometry.pdb" target="_blank">here</a> (its from the <a href="https://atb.uq.edu.au/molecule.py?molid=151371#panel-md" target="_blank">atb</a>),
and place it in the ‘preparation/’ folder.</p>
</div>
<section id="create-the-configuration-file">
<h3>Create the configuration file<a class="headerlink" href="#create-the-configuration-file" title="Link to this heading">¶</a></h3>
<div class="justify docutils container">
<p>First, let us convert the <em>.pdb</em> file into a <em>.gro</em> file
within a box of finite size (4 nm by 4 nm by 4 nm) using <em>trj conv</em>:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>gmx trjconv -f FJEW_allatom_optimised_geometry.pdb -s FJEW_allatom_optimised_geometry.pdb -o hbc.gro -box 4 4 4 -center
</pre></div>
</div>
<div class="justify docutils container">
<p>Select <em>system</em> for both centering and output.</p>
</div>
<figure class="align-center">
<a class="only-light reference internal image-reference" href="../../_images/hbc-light.png"><img alt="Gromacs initial configuration of HBC graphene molecule" class="only-light" src="../../_images/hbc-light.png" style="height: 250px;" /></a>
</figure>
<figure class="align-center">
<a class="only-dark reference internal image-reference" href="../../_images/hbc-dark.png"><img alt="Gromacs initial configuration of HBC graphene molecule" class="only-dark" src="../../_images/hbc-dark.png" style="height: 250px;" /></a>
</figure>
<div class="figurelegend docutils container">
<p>HBC molecule as seen with VMD with carbon atoms in gray and hydrogen
atoms in white. The honeycomb structure of the HBC is similar
to that of graphene.</p>
</div>
<div class="justify docutils container">
<p>Alternatively, you can download the <a href="../../../../../gromacstutorials-inputs/level3/solvation-energy/preparation/hbc.gro" target="_blank">file</a> I have generated,
and continue with the tutorial.</p>
</div>
</section>
<section id="create-the-topology-file">
<h3>Create the topology file<a class="headerlink" href="#create-the-topology-file" title="Link to this heading">¶</a></h3>
<div class="justify docutils container">
<p>Copy the force field files (ITP file)in a folder named ‘ff/’ and located within
the ‘preparation/’ folder. Force field parameters can be downloaded as a zip file by
clicking <a href="../../../../../gromacstutorials-inputs/level3/solvation-energy/preparation/ff-itp.zip" target="_blank">here</a>.</p>
</div>
<div class="justify docutils container">
<p>All the files contained in the ff folder were downloaded from the <a href="https://atb.uq.edu.au/molecule.py?molid=151371#panel-md" target="_blank">atb</a>.</p>
<p>Then, let us write the topology file by simply
creating a blank file named ‘topol.top’ within the
‘preparation/’ folder, and copying in it:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>#include &quot;ff/gromos54a7_atb.ff/forcefield.itp&quot;
#include &quot;ff/FJEW_GROMACS_G54A7FF_allatom.itp&quot;

[ system ]
Single HBC molecule

[ molecules ]
FJEW 1
</pre></div>
</div>
</section>
<section id="add-the-water">
<h3>Add the water<a class="headerlink" href="#add-the-water" title="Link to this heading">¶</a></h3>
<div class="justify docutils container">
<p>Let us add water molecules to the system. First, download the tip4p
water configuration file <a href="../../../../../gromacstutorials-inputs/level3/solvation-energy/preparation/tip4p.gro" target="_blank">here</a>,
and copy it in the ‘preparation/’ folder. Then, in
order to add (tip4p) water molecules to both gro and
top file, use the gmx solvate command as follow:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>gmx solvate -cs tip4p.gro -cp hbc.gro -o solvated.gro -p topol.top
</pre></div>
</div>
<div class="justify docutils container">
<p>You should see the following message:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>Processing topology
Adding line for 2186 solvent molecules with resname (SOL) to topology file (topol.top)
</pre></div>
</div>
<div class="justify docutils container">
<p>and a new line ‘SOL 2186’ in the topology file:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>[ molecules ]
FJEW 1
SOL 2186
</pre></div>
</div>
<div class="justify docutils container">
<p>The created <em>solvated.gro</em> file contains the positions
of both HBC (called FJEW) and water molecules . Alternatively, you
can download the file I have generated by clicking <a href="../../../../../gromacstutorials-inputs/level3/solvation-energy/preparation/solvated.gro" target="_blank">here</a>.</p>
</div>
<div class="justify docutils container">
<p>The only missing information is the force field for
the water molecule. In order to use the TIP4P/epsilon
water model, which is one of the best classical water model, copy the
<a href="../../../../../gromacstutorials-inputs/level3/solvation-energy/preparation/ff/h2o.itp" target="_blank">h2o.itp</a> file in the ‘ff/’ folder and modify the beginning of
the topology file as follow:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>#include &quot;ff/gromos54a7_atb.ff/forcefield.itp&quot;
#include &quot;ff/FJEW_GROMACS_G54A7FF_allatom.itp&quot;
#include &quot;ff/h2o.itp&quot;
</pre></div>
</div>
<div class="justify docutils container">
<p>The system is ready, let us equilibrate it before measuring the solvation
energy of the HBC molecule.</p>
</div>
</section>
</section>
<section id="energy-minimization">
<h2>Energy minimization<a class="headerlink" href="#energy-minimization" title="Link to this heading">¶</a></h2>
<div class="justify docutils container">
<p>Create an <em>inputs/</em> folder inside the <em>preparation/</em> folder,
and create a new blank file called
<em>min.mdp</em> in it. Copy the following lines into <em>min.mdp</em>:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>integrator = steep
nsteps = 50

nstxout = 10

cutoff-scheme = Verlet
nstlist = 10
ns_type = grid

couple-intramol=yes

vdw-type = Cut-off
rvdw = 1.2

coulombtype = pme
fourierspacing = 0.1
pme-order = 4
rcoulomb = 1.2

constraint-algorithm = lincs
constraints = hbonds
</pre></div>
</div>
<div class="justify docutils container">
<p>All these lines have been seen in the first
tutorial, <a class="reference internal" href="../level1/bulk-solution.html#bulk-solution-label"><span class="std std-ref">Bulk salt solution</span></a>. In short, this script will perform a
steepest descent by updating the atom positions
according to the largest forces directions, until
the energy and maximum force reach a reasonable
value.</p>
</div>
<div class="justify docutils container">
<p>Apply the minimization to the solvated box using <em>gmx grompp</em>:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>inputs/min.mdp<span class="w"> </span>-c<span class="w"> </span>solvated.gro<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>min<span class="w"> </span>-pp<span class="w"> </span>min<span class="w"> </span>-po<span class="w"> </span>min<span class="w"> </span>-maxwarn<span class="w"> </span><span class="m">1</span>
gmx<span class="w"> </span>mdrun<span class="w"> </span>-v<span class="w"> </span>-deffnm<span class="w"> </span>min
</pre></div>
</div>
<div class="justify docutils container">
<p>Here, the <em>-maxwarn 1</em> allows us to perform the
simulation despite GROMACS warning about some force
field issue. For this tutorial, we can safely ignore this warning.</p>
</div>
<div class="justify docutils container">
<p>Let us visualize the atom trajectories during the
minimization step using VMD by typing:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>solvate.gro<span class="w"> </span>min.trr
</pre></div>
</div>
<figure class="align-center">
<a class="only-light reference internal image-reference" href="../../_images/minimize-light.png"><img alt="Gromacs HBC (graphene) molecule after minimization in water" class="only-light" src="../../_images/minimize-light.png" style="height: 400px;" /></a>
</figure>
<figure class="align-center">
<a class="only-dark reference internal image-reference" href="../../_images/minimize-dark.png"><img alt="Gromacs HBC (graphene) molecule after minimization in water" class="only-dark" src="../../_images/minimize-dark.png" style="height: 400px;" /></a>
</figure>
<div class="figurelegend docutils container">
<p>System after energy minimization showing the HBC molecule in water.
The water is represented as a transparent field.</p>
</div>
</section>
<section id="equilibration">
<h2>Equilibration<a class="headerlink" href="#equilibration" title="Link to this heading">¶</a></h2>
<div class="justify docutils container">
<p>Let us perform successively a NVT and a NPT relaxation. Copy the <a href="../../../../../gromacstutorials-inputs/level3/solvation-energy/preparation/inputs/nvt.mdp" target="_blank">nvt.mdp</a>
and the <a href="../../../../../gromacstutorials-inputs/level3/solvation-energy/preparation/inputs/npt.mdp" target="_blank">npt.mdp</a> files into the inputs folder, and run them both using:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>inputs/nvt.mdp<span class="w"> </span>-c<span class="w"> </span>min.gro<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>nvt<span class="w"> </span>-pp<span class="w"> </span>nvt<span class="w"> </span>-po<span class="w"> </span>nvt<span class="w"> </span>-maxwarn<span class="w"> </span><span class="m">1</span>
gmx<span class="w"> </span>mdrun<span class="w"> </span>-v<span class="w"> </span>-deffnm<span class="w"> </span>nvt
gmx<span class="w"> </span>grompp<span class="w"> </span>-f<span class="w"> </span>inputs/npt.mdp<span class="w"> </span>-c<span class="w"> </span>nvt.gro<span class="w"> </span>-p<span class="w"> </span>topol.top<span class="w"> </span>-o<span class="w"> </span>npt<span class="w"> </span>-pp<span class="w"> </span>npt<span class="w"> </span>-po<span class="w"> </span>npt<span class="w"> </span>-maxwarn<span class="w"> </span><span class="m">1</span>
gmx<span class="w"> </span>mdrun<span class="w"> </span>-v<span class="w"> </span>-deffnm<span class="w"> </span>npt
</pre></div>
</div>
<figure class="align-center">
<a class="only-light reference internal image-reference" href="../../_images/nvtnpt-light.webp"><img alt="Gromacs HBC (graphene) molecule during NVT and NPT equilibration" class="only-light" src="../../_images/nvtnpt-light.webp" style="height: 400px;" /></a>
</figure>
<figure class="align-center">
<a class="only-dark reference internal image-reference" href="../../_images/nvtnpt-dark.webp"><img alt="Gromacs HBC (graphene) molecule during NVT and NPT equilibration" class="only-dark" src="../../_images/nvtnpt-dark.webp" style="height: 400px;" /></a>
</figure>
<div class="figurelegend docutils container">
<p>Movie showing the motion of the atoms during the
NVT and NPT equilibration steps. For clarity, the
water molecules are represented as a continuum field.</p>
</div>
</section>
<section id="solvation-energy-measurement">
<h2>Solvation energy measurement<a class="headerlink" href="#solvation-energy-measurement" title="Link to this heading">¶</a></h2>
<div class="justify docutils container">
<p>We are done with the first equilibration of the
system. We are now going to perform the solvation
free energy calculation, for which 21 independent
simulations will be performed.</p>
</div>
<div class="justify docutils container">
<p><strong>Quick explanation of the procedure:</strong> The
interactions between the HBC molecule and water
are progressively turned-off, thus effectively
mimicking the HBC molecule moving from bulk water
to vacuum.</p>
</div>
<div class="justify docutils container">
<p>Within the ‘solvation/’ folder, create an ‘inputs/’
folders. Copy the two following
<a href="../../../../../gromacstutorials-inputs/level3/solvation-energy/solvation/inputs/npt_bis.mdp" target="_blank">npt_bis.mdp</a> and <a href="../../../../../gromacstutorials-inputs/level3/solvation-energy/solvation/inputs/pro.mdp" target="_blank">pro.mdp</a> files in it.</p>
</div>
<div class="justify docutils container">
<p>Both files contain the following commands that are
related to the free energy calculation:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>free_energy = yes
vdw-lambdas = 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
coul-lambdas = 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0
sc-alpha = 0.5
sc-power = 1
init-lambda-state =  0
couple-lambda0 = none
couple-lambda1 = vdw-q
nstdhdl = 100
calc_lambda_neighbors = -1
couple-moltype = FJEW
</pre></div>
</div>
<div class="justify docutils container">
<p>These lines specify that the decoupling between the
molecule of interest (here FJEW) and the rest of
the system (here water) must be done by
progressively turning off van der Waals and Coulomb
interactions. The parameter <em>nstdhdl</em> controls the frequency at
which information are being printed in a xvg file during
the production run.</p>
</div>
<div class="justify docutils container">
<p>In addition, the stochastic integrator ‘sd’ is used
instead of ‘md’, as it provides a better sampling,
which is crucial here, particularly when the HBC
and the water molecules are not coupled.</p>
</div>
<div class="justify docutils container">
<p>Copy as well the following <a href="../../../../../gromacstutorials-inputs/level3/solvation-energy/solvation/topol.top" target="_blank">topol.top</a> file within the
<em>solvation/</em> folder (the only difference with the previous one if the path
to the <em>ff/</em> folder).</p>
</div>
<div class="justify docutils container">
<p>We need to create 21 folders, each containing the
input files with different value of
init-lambda-state (from 0 to 21). To do so, create
a new bash file fine within the ‘solvation/’
folder, call it ‘createfolders.sh’ can copy the
following lines in it:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>#/bin/bash
# delete runall.sh if it exist, then re-create it
if test -f &quot;runall.sh&quot;; then
    rm runall.sh
fi
touch runall.sh
echo &#39;#/bin/bash&#39; &gt;&gt; runall.sh
echo &#39;&#39; &gt;&gt; runall.sh
# folder for analysis
mkdir -p dhdl
# loop on the 21 lambda state
for state in $(seq 0 20);
do
    # create folder
    DIRNAME=lambdastate${state}
    mkdir -p $DIRNAME
    # copy the topology, inputs, and configuration file in the folder
    cp -r topol.top $DIRNAME
    cp -r ../preparation/npt.gro $DIRNAME/preparedstate.gro
    cp -r inputs $DIRNAME
    # replace the lambda state in both npt_bis and production mdp file
    newline=&#39;init-lambda-state = &#39;$state
    linetoreplace=$(cat $DIRNAME/inputs/npt_bis.mdp | grep init-lambda-state)
    sed -i &#39;/&#39;&quot;$linetoreplace&quot;&#39;/c\&#39;&quot;$newline&quot; $DIRNAME/inputs/npt_bis.mdp
    sed -i &#39;/&#39;&quot;$linetoreplace&quot;&#39;/c\&#39;&quot;$newline&quot; $DIRNAME/inputs/pro.mdp
    # create a bash file to launch all the simulations
    echo &#39;cd &#39;$DIRNAME &gt;&gt; runall.sh
    echo &#39;gmx grompp -f inputs/npt_bis.mdp -c preparedstate.gro -p topol.top -o npt_bis -pp npt_bis -po npt_bis -maxwarn 1&#39; &gt;&gt; runall.sh
    echo &#39;gmx mdrun -v -deffnm npt_bis -nt 4&#39; &gt;&gt; runall.sh
    echo &#39;gmx grompp -f inputs/pro.mdp -c npt_bis.gro -p topol.top -o pro -pp pro -po pro -maxwarn 1&#39; &gt;&gt; runall.sh
    echo &#39;gmx mdrun -v -deffnm pro -nt 4&#39; &gt;&gt; runall.sh
    echo &#39;cd ..&#39; &gt;&gt; runall.sh
    echo &#39;&#39; &gt;&gt; runall.sh
    # create links for the analysis
    cd dhdl
    ln -sf ../$DIRNAME/pro.xvg md$state.xvg
    cd ..
done
</pre></div>
</div>
<div class="justify docutils container">
<p>Change the <em>-nt 4</em> to use a different number of thread if necessary
or/and possible.</p>
</div>
<div class="justify docutils container">
<p>Execute the bash script by typing:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>createfolders.sh
</pre></div>
</div>
<div class="justify docutils container">
<p>The bash file creates 21 folders, each containing
the input files with init-lambda-state from 0 to
21, as well as a ‘topol.top’ file and a
‘preparedstate.gro’ corresponding to the last
state of the system simulated in the
‘preparation/’ folder. Run all 21 simulations by executing the ‘runall.sh’ script:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>runall.sh
</pre></div>
</div>
<div class="justify docutils container">
<p>This may take a while, depending on your computer.</p>
<p>When the simulation is complete, go the dhdl folder, and type:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx<span class="w"> </span>bar<span class="w"> </span>-f<span class="w"> </span>*.xvg
</pre></div>
</div>
<div class="justify docutils container">
<p>The value of the solvation energy is printed in the terminal:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>total<span class="w"> </span><span class="m">0</span><span class="w"> </span>-<span class="w"> </span><span class="m">20</span>,<span class="w"> </span>DG<span class="w"> </span>-37.0<span class="w"> </span>+/-<span class="w"> </span><span class="m">8</span>.40
</pre></div>
</div>
<div class="justify docutils container">
<p>The present simulations are too short to give a
reliable result. To accurately measure the solvation
energy of a molecule, use much longer equilibration
(typically one nanosecond) and production runs
(typically several nanoseconds).</p>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="adsorption-ethanol.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Free energy profile</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../level2/stretching-a-polymer.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Polymer in water</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Molecule solvation energy</a><ul>
<li><a class="reference internal" href="#input-files">Input files</a><ul>
<li><a class="reference internal" href="#create-the-configuration-file">Create the configuration file</a></li>
<li><a class="reference internal" href="#create-the-topology-file">Create the topology file</a></li>
<li><a class="reference internal" href="#add-the-water">Add the water</a></li>
</ul>
</li>
<li><a class="reference internal" href="#energy-minimization">Energy minimization</a></li>
<li><a class="reference internal" href="#equilibration">Equilibration</a></li>
<li><a class="reference internal" href="#solvation-energy-measurement">Solvation energy measurement</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=4e2eecee"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    </body>
</html>